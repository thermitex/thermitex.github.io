function genFileName(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),a=e.getMinutes(),o=e.getSeconds();return"export-"+t+n+r+i+a+o}function getCal(e,t,n){for(var r=ics("weekly.cal.hku.hk","thermitex"),i=e.split("\n"),a=0;a<i.length;a++){var o=i[a],l=o.split("\t");if(7!=l.length)return void alert("Invalid Input!");if("Approved"==l[4]){var s=l[2].slice(0,12);r=getEvent(r,l[3],s,t,n)}}return r}function getEvent(e,t,n,r,i){for(var a,o,l,s,u=t.split(" "),c=100,d=new Date,f=d.getDay(),g=new Date(d.getFullYear(),d.getMonth(),d.getDate()),v="",S=0,y=[],p=[],E=0;E<u.length;E++)if("Mo"==u[E]||"Tu"==u[E]||"We"==u[E]||"Th"==u[E]||"Fr"==u[E]||"Sa"==u[E]){if(S++,S>1){if(!y.includes(l.getTime())||!p.includes(s.getTime())){if(r){var h={freq:"WEEKLY",until:i,interval:1};e.addEvent(n,"",v,l,s,h)}else e.addEvent(n,"",v,l,s);y.push(l.getTime()),p.push(s.getTime())}v=""}switch(c=E,u[E]){case"Mo":a=1;break;case"Tu":a=2;break;case"We":a=3;break;case"Th":a=4;break;case"Fr":a=5;break;case"Sa":a=6}o=a-f,o<0&&(o+=7),l=new Date(g),s=new Date(g),l.setDate(l.getDate()+o),s.setDate(s.getDate()+o)}else E==c+1?l=setExactTime(l,u[E]):E==c+3?s=setExactTime(s,u[E]):E>=c+4&&(v+=u[E]+" ");return e}function setExactTime(e,t){var n=t.slice(-2),r=t.slice(0,-2).split(":");e.setMinutes(r[1]);var i=parseInt(r[0]);return"AM"==n&&12==i&&(i-=12),"PM"==n&&12!=i&&(i+=12),e.setHours(i),e}$(document).ready(function(){var e=new Date,t=("0"+e.getDate()).slice(-2),n=("0"+(e.getMonth()+1)).slice(-2),r=e.getFullYear()+"-"+n+"-"+t;$("#untildate").val(r),$("button").click(function(){var e=getCal($("#enrolinfo").val(),$("#rpt").is(":checked"),$("#untildate").val());e.download(genFileName())})});var ics=function(e,t){"use strict";if(!(navigator.userAgent.indexOf("MSIE")>-1&&-1==navigator.userAgent.indexOf("MSIE 10"))){void 0===e&&(e="default"),void 0===t&&(t="Calendar");var n=-1!==navigator.appVersion.indexOf("Win")?"\r\n":"\n",r=[],i=["BEGIN:VCALENDAR","PRODID:"+t,"VERSION:2.0","X-WR-CALNAME:HKU Weekly Schedule"].join(n),a=n+"END:VCALENDAR",o=["SU","MO","TU","WE","TH","FR","SA"];return{events:function(){return r},calendar:function(){return i+n+r.join(n)+a},addEvent:function(t,i,a,l,s,u){if(void 0===t||void 0===i||void 0===a||void 0===l||void 0===s)return!1;if(u&&!u.rrule){if("YEARLY"!==u.freq&&"MONTHLY"!==u.freq&&"WEEKLY"!==u.freq&&"DAILY"!==u.freq)throw"Recurrence rrule frequency must be provided and be one of the following: 'YEARLY', 'MONTHLY', 'WEEKLY', or 'DAILY'";if(u.until&&isNaN(Date.parse(u.until)))throw"Recurrence rrule 'until' must be a valid date string";if(u.interval&&isNaN(parseInt(u.interval)))throw"Recurrence rrule 'interval' must be an integer";if(u.count&&isNaN(parseInt(u.count)))throw"Recurrence rrule 'count' must be an integer";if(void 0!==u.byday){if("[object Array]"!==Object.prototype.toString.call(u.byday))throw"Recurrence rrule 'byday' must be an array";if(u.byday.length>7)throw"Recurrence rrule 'byday' array must not be longer than the 7 days in a week";for(var c in u.byday=u.byday.filter(function(e,t){return u.byday.indexOf(e)==t}),u.byday)if(o.indexOf(u.byday[c])<0)throw"Recurrence rrule 'byday' values must include only the following: 'SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'"}}var d=new Date(l),f=new Date(s),g=new Date,v=("0000"+d.getFullYear().toString()).slice(-4),S=("00"+(d.getMonth()+1).toString()).slice(-2),y=("00"+d.getDate().toString()).slice(-2),p=("00"+d.getHours().toString()).slice(-2),E=("00"+d.getMinutes().toString()).slice(-2),h=("00"+d.getSeconds().toString()).slice(-2),w=("0000"+f.getFullYear().toString()).slice(-4),T=("00"+(f.getMonth()+1).toString()).slice(-2),D=("00"+f.getDate().toString()).slice(-2),b=("00"+f.getHours().toString()).slice(-2),m=("00"+f.getMinutes().toString()).slice(-2),A=("00"+f.getSeconds().toString()).slice(-2),N=("0000"+g.getFullYear().toString()).slice(-4),I=("00"+(g.getMonth()+1).toString()).slice(-2),R=("00"+g.getDate().toString()).slice(-2),O=("00"+g.getHours().toString()).slice(-2),M=("00"+g.getMinutes().toString()).slice(-2),L=("00"+g.getSeconds().toString()).slice(-2),U="",Y="";p+E+h+b+m+A!=0&&(U="T"+p+E+h,Y="T"+b+m+A);var x,k="T"+O+M+L,F=v+S+y+U,C=w+T+D+Y,H=N+I+R+k;if(u)if(u.rrule)x=u.rrule;else{if(x="RRULE:FREQ="+u.freq,u.until){var j=new Date(Date.parse(u.until)).toISOString();x+=";UNTIL="+j.substring(0,j.length-13).replace(/[-]/g,"")+"000000Z"}u.interval&&(x+=";INTERVAL="+u.interval),u.count&&(x+=";COUNT="+u.count),u.byday&&u.byday.length>0&&(x+=";BYDAY="+u.byday.join(","))}(new Date).toISOString();var B=["BEGIN:VEVENT","UID:"+(new Date).getTime()+r.length+"@"+e,"CLASS:PUBLIC","DESCRIPTION:"+i,"DTSTAMP;VALUE=DATE-TIME:"+H,"DTSTART;TZID=Asia/Hong_Kong:"+F,"DTEND;TZID=Asia/Hong_Kong:"+C,"LOCATION:"+a,"SUMMARY;LANGUAGE=en-us:"+t,"TRANSP:TRANSPARENT","SEQUENCE:0","END:VEVENT"];return x&&B.splice(4,0,x),B=B.join(n),r.push(B),B},download:function(e,t){if(r.length<1)return!1;t=void 0!==t?t:".ics",e=void 0!==e?e:"calendar";var o,l=i+n+r.join(n)+a;if(-1===navigator.userAgent.indexOf("MSIE 10"))o=new Blob([l]);else{var s=new BlobBuilder;s.append(l),o=s.getBlob("text/calendar;charset="+document.characterSet)}return saveAs(o,e+t),l},build:function(){if(r.length<1)return!1;var e=i+n+r.join(n)+a;return e}}}console.log("Unsupported Browser")},saveAs=saveAs||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),i="download"in r,a=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},o=/constructor/i.test(e.HTMLElement)||e.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u="application/octet-stream",c=4e4,d=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,c)},f=function(e,t,n){t=[].concat(t);for(var r=t.length;r--;){var i=e["on"+t[r]];if("function"==typeof i)try{i.call(e,n||e)}catch(e){s(e)}}},g=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},v=function(t,s,c){c||(t=g(t));var v,S=this,y=t.type,p=y===u,E=function(){f(S,"writestart progress write writeend".split(" "))},h=function(){if((l||p&&o)&&e.FileReader){var r=new FileReader;return r.onloadend=function(){var t=l?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;"),n=e.open(t,"_blank");n||(e.location.href=t),t=void 0,S.readyState=S.DONE,E()},r.readAsDataURL(t),void(S.readyState=S.INIT)}if(v||(v=n().createObjectURL(t)),p)e.location.href=v;else{var i=e.open(v,"_blank");i||(e.location.href=v)}S.readyState=S.DONE,E(),d(v)};if(S.readyState=S.INIT,i)return v=n().createObjectURL(t),void setTimeout(function(){r.href=v,r.download=s,a(r),E(),d(v),S.readyState=S.DONE});h()},S=v.prototype,y=function(e,t,n){return new v(e,t||e.name||"download",n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=g(e)),navigator.msSaveOrOpenBlob(e,t)}:(S.abort=function(){},S.readyState=S.INIT=0,S.WRITING=1,S.DONE=2,S.error=S.onwritestart=S.onprogress=S.onwrite=S.onabort=S.onerror=S.onwriteend=null,y)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return saveAs});